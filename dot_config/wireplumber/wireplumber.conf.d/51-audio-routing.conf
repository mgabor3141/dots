# Audio routing policy
#
# - Default sink is system-audio (loopback → Scarlett for local playback)
# - Discord → discord-audio sink (via stream-restore saved target)
# - Sunshine captures system-audio.monitor → gets everything except Discord
# - Sunshine's default-sink hijack is reverted by global_prep_cmd
#
# Virtual sinks and loopbacks are created by system-audio-sink.service

wireplumber.settings = {
  default.configured.audio.sink = "system-audio"
}

wireplumber.profiles = {
  main = {
    node.rules = [
      # Prevent Sunshine sinks from becoming default
      {
        matches = [
          { node.name = "~sink-sunshine-.*" }
        ]
        actions = {
          update-props = {
            priority.session = 0
            node.autoconnect = false
          }
        }
      }
      # Prevent Scarlett mic from auto-connecting to sinks
      {
        matches = [
          { node.name = "~alsa_input.usb-Focusrite_Scarlett_8i6_USB_.*" media.class = "Audio/Source" }
        ]
        actions = {
          update-props = {
            node.autoconnect = false
          }
        }
      }
    ]
  }
}
