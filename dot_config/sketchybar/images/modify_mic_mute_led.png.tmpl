#!/bin/bash
# Generate the mic-mute LED glow indicator image.
#
# Three composited layers (outer glow → mid glow → bright core) with gaussian
# blur produce a glowing LED strip effect. Output is a 900x30 PNG written to
# stdout so chezmoi can manage it as a modify_ script.
#
# Requires: ImageMagick 7 (magick)
#
# Color reference: matches the waybar mute indicator CSS gradient
#   (dot_config/waybar-mute-indicator/style.css)

set -euo pipefail
cat > /dev/null  # drain stdin (existing file contents, if any)

tmp=$(mktemp /tmp/mic_mute_led.XXXXXX.png)
trap 'rm -f "$tmp"' EXIT

magick -size 900x30 xc:none \
  \( -size 900x30 xc:none \
     -fill "rgba(255,0,0,0.7)" -draw "roundrectangle 90,7 809,22 8,8" \
     -blur 12x9 \
  \) -gravity center -composite \
  \( -size 900x30 xc:none \
     -fill "rgba(255,40,40,1)" -draw "roundrectangle 95,10 804,19 5,5" \
     -blur 8x4 \
  \) -gravity center -composite \
  \( -size 900x30 xc:none \
     -fill "rgba(255,200,200,0.95)" -draw "roundrectangle 100,12 799,17 3,3" \
     -blur 6x1 \
  \) -gravity center -composite \
  "$tmp"

cat "$tmp"
