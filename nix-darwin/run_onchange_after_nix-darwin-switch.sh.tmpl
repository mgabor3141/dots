#!/bin/bash

# This script will run if any of the following files have changed
# flake.lock hash: {{ include "nix-darwin/flake.lock" | sha256sum }}
# flake.nix.tmpl hash: {{ include "nix-darwin/flake.nix.tmpl" | sha256sum }}
# darwin-config.nix hash: {{ include "nix-darwin/darwin-config.nix" | sha256sum }}

if ! nix --version >/dev/null 2>&1; then
  curl -fsSL https://install.determinate.systems/nix | sh -s -- install || {
    echo "Nix not installed!"
    exit 0
  }
fi

sudo nix --extra-experimental-features "nix-command flakes" \
  run nix-darwin/nix-darwin-25.05#darwin-rebuild -- switch --flake .
