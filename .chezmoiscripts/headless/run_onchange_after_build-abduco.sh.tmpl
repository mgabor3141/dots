{{- if .headless -}}
#!/bin/bash
# abduco-version: 0.6-git-8c32909
# hash: {{ include (joinPath .chezmoi.sourceDir ".chezmoiscripts/linux/run_onchange_after_build-abduco.sh.tmpl") | sha256sum }}
set -Eeuo pipefail
trap 'echo "âŒ Error on line $LINENO: $BASH_COMMAND" >&2' ERR

DEST="{{ .chezmoi.workingTree }}/bin"
mkdir -p "$DEST"

echo "Building abduco (static, via Docker)..."

docker run --rm -v "$DEST":/output alpine:latest sh -c '
    apk add --no-cache gcc musl-dev make git >/dev/null 2>&1 &&
    git clone --depth 1 https://github.com/martanne/abduco.git /tmp/abduco &&
    cd /tmp/abduco &&
    CFLAGS="-static" make &&
    cp abduco /output/abduco
'

chmod +x "$DEST/abduco"
echo "âœ… abduco installed: $("$DEST/abduco" -v 2>&1)"
{{- end }}
