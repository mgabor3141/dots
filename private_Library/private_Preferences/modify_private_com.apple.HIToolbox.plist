#!/bin/bash
# Selectively configure keyboard layout and input sources.
# shellcheck source=.plist_common.sh
source "$CHEZMOI_SOURCE_DIR/private_Library/private_Preferences/.plist_common.sh"

# Default keyboard layout
set_string AppleCurrentKeyboardLayoutInputSourceID 'org.unknown.keylayout.QWERTY'

# Fn key behavior: 0 = do nothing (let Kanata handle it)
set_int    AppleFnUsageType 0

# Enabled input sources: character palette (emoji picker) + QWERTY layout
plutil -remove AppleEnabledInputSources "$tmp" 2>/dev/null || true
plutil -insert AppleEnabledInputSources -json '[
    {"Bundle ID": "com.apple.CharacterPaletteIM", "InputSourceKind": "Non Keyboard Input Method"},
    {"InputSourceKind": "Keyboard Layout", "KeyboardLayout ID": -3141, "KeyboardLayout Name": "QWERTY"}
]' "$tmp"

# Selected input source: QWERTY layout
plutil -remove AppleSelectedInputSources "$tmp" 2>/dev/null || true
plutil -insert AppleSelectedInputSources -json '[
    {"InputSourceKind": "Keyboard Layout", "KeyboardLayout ID": -3141, "KeyboardLayout Name": "QWERTY"}
]' "$tmp"

plist_finalize
