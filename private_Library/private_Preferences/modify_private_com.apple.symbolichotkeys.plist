#!/bin/bash
# Selectively disable macOS symbolic hotkeys.
# shellcheck source=.plist_common.sh
source "$CHEZMOI_SOURCE_DIR/private_Library/private_Preferences/.plist_common.sh"

# Ensure parent dict exists
pb -c "Add :AppleSymbolicHotKeys dict" 2>/dev/null || true

disable_hotkey() {
    pb -c "Add :AppleSymbolicHotKeys:$1 dict" 2>/dev/null || true
    pb -c "Set :AppleSymbolicHotKeys:$1:enabled false" 2>/dev/null ||
        pb -c "Add :AppleSymbolicHotKeys:$1:enabled bool false"
}

enable_hotkey() {
    local k=$1; shift
    pb -c "Add :AppleSymbolicHotKeys:$k dict" 2>/dev/null || true
    pb -c "Set :AppleSymbolicHotKeys:$k:enabled true" 2>/dev/null ||
        pb -c "Add :AppleSymbolicHotKeys:$k:enabled bool true"
    # Recreate value with exact parameters
    pb -c "Delete :AppleSymbolicHotKeys:$k:value" 2>/dev/null || true
    pb -c "Add :AppleSymbolicHotKeys:$k:value dict"
    pb -c "Add :AppleSymbolicHotKeys:$k:value:parameters array"
    pb -c "Add :AppleSymbolicHotKeys:$k:value:parameters:0 integer $1"
    pb -c "Add :AppleSymbolicHotKeys:$k:value:parameters:1 integer $2"
    pb -c "Add :AppleSymbolicHotKeys:$k:value:parameters:2 integer $3"
    pb -c "Add :AppleSymbolicHotKeys:$k:value:type string standard"
}

# Disable all known hotkeys (only touches enabled field, preserves value dicts)
for k in \
    7 8 9 10 11 12 13 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 \
    32 33 36 52 53 54 57 59 60 61 64 65 79 81 98 \
    118 159 162 164 175 190 \
    215 216 217 218 219 222 223 224 225 226 227 228 229 \
    230 231 232 233 235 237 238 239 \
    240 241 242 243 244 245 246 247 248 249 \
    250 251 256 257 258 260; do
    disable_hotkey "$k"
done

# Enable specific hotkeys with their key bindings
#   31: Cmd+Shift+1 — save screenshot to file (via Cmd+Shift+!)
enable_hotkey 31  49 18 1179648
#   80: Ctrl+Left — move left a space
enable_hotkey 80  65535 123 8781824
#   82: Ctrl+Right — move right a space
enable_hotkey 82  65535 124 8781824
#  184: Cmd+Opt+5 — accessibility shortcuts
enable_hotkey 184 53 23 1179648

plist_finalize
