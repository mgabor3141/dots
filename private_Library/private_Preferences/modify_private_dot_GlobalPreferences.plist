#!/bin/bash
# Selectively configure global macOS preferences.
# shellcheck source=.plist_common.sh
source "$CHEZMOI_SOURCE_DIR/private_Library/private_Preferences/.plist_common.sh"

# --- Appearance ---
set_string AppleInterfaceStyle         Dark
set_bool   AppleMenuBarVisibleInFullscreen false
set_bool   _HIHideMenuBar              true
set_int    AppleAntiAliasingThreshold  4
set_int    NSTableViewDefaultSizeMode  2
set_bool   AppleMiniaturizeOnDoubleClick false

# --- Locale & Language ---
set_string AppleLocale                 "en_US@rg=huzzzz"
set_string AppleMeasurementUnits       Centimeters
set_int    AppleMetricUnits            1
set_string AppleTemperatureUnit        Celsius

# AppleLanguages array
plutil -remove AppleLanguages "$tmp" 2>/dev/null || true
plutil -insert AppleLanguages -json '["en-US","hu-HU"]' "$tmp"

# --- Keyboard & Text ---
set_bool   ApplePressAndHoldEnabled    false
set_bool   NSAutomaticCapitalizationEnabled    true
set_bool   NSAutomaticPeriodSubstitutionEnabled false

# Quote style strings (contain literal quotes â€” use plutil)
pl_set_string KB_DoubleQuoteOption '"abc"'
pl_set_string KB_SingleQuoteOption "'abc'"

# Spelling language: auto-detect
plutil -remove KB_SpellingLanguage "$tmp" 2>/dev/null || true
plutil -insert KB_SpellingLanguage -json '{"KB_SpellingLanguageIsAutomatic":true}' "$tmp"

# Smart quotes: straight quotes only
plutil -remove NSUserQuotesArray "$tmp" 2>/dev/null || true
plutil -insert NSUserQuotesArray -json '["\u0022","\u0022","\u0027","\u0027"]' "$tmp"

# --- Mouse & Trackpad ---
set_bool   com.apple.mouse.linear     true
set_real   com.apple.mouse.scaling    0.6875
set_int    com.apple.mouse.tapBehavior 1
set_real   com.apple.scrollwheel.scaling 0.3125
set_bool   com.apple.swipescrolldirection true
set_bool   com.apple.trackpad.forceClick false

# --- Sound ---
set_int    com.apple.sound.beep.feedback 0
set_int    com.apple.sound.beep.flash   0

# --- Finder & Dialogs ---
set_bool   NSDocumentSaveNewDocumentsToCloud false
set_bool   NSNavPanelExpandedStateForSaveMode  true
set_bool   NSNavPanelExpandedStateForSaveMode2 true
set_bool   PMPrintingExpandedStateForPrint     true
set_bool   PMPrintingExpandedStateForPrint2    true
set_bool   com.apple.springing.enabled true
set_real   com.apple.springing.delay   0.5
set_bool   NSVisualBidiSelectionEnabled true

# Preferred web search engine
plutil -remove NSPreferredWebServices "$tmp" 2>/dev/null || true
plutil -insert NSPreferredWebServices -json \
    '{"NSWebServicesProviderWebSearch":{"NSDefaultDisplayName":"Google","NSProviderIdentifier":"com.google.www"}}' "$tmp"

plist_finalize
